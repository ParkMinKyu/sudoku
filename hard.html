<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>스도쿠 게임 (sudoku game)</title>
<link rel="stylesheet" href="sudoku.css"/>
<script type="text/javascript" src="jquery-1.11.3.min.js"></script>
<script type="text/javascript">
$(function(){
  var checkTime = setInterval(function(){
    let time = parseInt($('#gameTime').text());
    $('#gameTime').text(++time);
  },1000);
	var map = [[0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0],
			[0,0,0,0,0,0,0,0,0]];
	/* $('.area').attr("contenteditable","true"); */
	createMap();
	shuffleMap(5);
	putNumber();
	setGameNumber();
  	checkTime;
  	
	function createMap(){
		let count = 0;
		let isCreate = false;
		while(isCreate == false){
			for(let x = 0 ; x < 9 ; x ++){
				let number = createNumber();
				for(let y = 0 ; y < 9 ;  y ++){
					if(checkNum(x, y, number)){
						map[x][y]=number;
					}
				}
			}
			count++
			isCreate = isComplete();
			if(count > 10000){
				console.log("create map fail retry......")
				count = 0 ;
				resetMap();
			}
		}
		console.log(map)
	}
	function resetMap(){
		for(let x = 0 ; x < 9 ; x ++){
			for(let y = 0 ; y < 9 ;  y ++){
				map[x][y] = 0;
			}
		}
	}
	function isComplete(){
		for(let x = 0 ; x < 9 ; x ++){
			for(let y = 0 ; y < 9 ;  y ++){
				if(map[x][y] == 0){
					return false;
				}
			}
		}
		return true;
	}
	function createNumber(){
		return parseInt(Math.random()*9)+1;
	}
	function checkNum(x, y, number){		
		for(let i = 0 ; i < 9 ; i ++){
			if(map[x][i] == number)return false;
		}
		
		for(let i = 0 ; i < 9 ; i ++){
			if(map[i][y] == number)return false;
		}
		
		let ckxst = parseInt(x/3)*3;
		let ckxed = ckxst + 3;
		let ckyst = parseInt(y/3)*3;
		let ckyed = ckyst + 3;
		
		for(let i = ckxst ; i < ckxed ; i ++){
			for(let k = ckyst ; k < ckyed ; k ++){
				if(map[i][k] == number)return false;
			}
		}
		
		return true;
	}
	function shuffleMap(count){
		for(let cnt = 0 ; cnt < count ; cnt ++){
			let poy1 = parseInt(Math.random()*9);
      let poy2 = 0;
      if(poy1 % 3 == 0) poy2 = (poy1 + (parseInt(Math.random()*2)+1));
      else if(poy1 % 3 == 1)poy2 = (parseInt(Math.random()*2) == 0 ? (poy1 - 1) : (poy1 + 1));
      else if(poy1 % 3 == 2)poy2 = (poy1 - (parseInt(Math.random()*2)+1));
      else console.log('shuffleMap error');
			for(let x = 0 ; x < 9 ; x ++){
				let temp = map[x][poy1];
				map[x][poy1] = map[x][poy2];
				map[x][poy2] = temp;
			}
		}
		console.log(map)
	}
	function putNumber(){
		for(let x = 0 ; x < 9 ; x ++){
			for(let y = 0 ; y < 9 ;  y ++){
				$('.row').eq(x).find('div').eq(y).text(map[x][y]);
			}
		}
	}
	function setGameNumber(){
		for(let i = 0 ; i < 35 ; i ++){
			let pox = parseInt(Math.random()*9);
			let poy = parseInt(Math.random()*9);
			$('.row').eq(pox).find('div').eq(poy).attr("contenteditable","true").addClass('userInput').text('');
		}
	}
	$('#finishBtn').click(function(){
		for(let x = 0 ; x < 9 ; x ++){
			for(let y = 0 ; y < 9 ;  y ++){
				let realNum = map[x][y];
				let userNum = parseInt($('.row').eq(x).find('div').eq(y).text());
				if(realNum != userNum){
					alert('You Faild.');
					return false;
				}
			}
		}
		alert("You Win. You finished : " + $('#gameTime').text() + "sec.");
		$('#reloadBtn').click();
	});
	$('#reloadBtn').click(function(){
		location.reload();
	});
	$('#easyBtn').click(function(){
		location.href="index.html"
	});
});
</script>
</head>
<body>
<button id="reloadBtn">reload</button>
<button id="easyBtn">go easy mode</button>
<div class="timeArea">
  경과시간 : <span id="gameTime">0</span>
</div>
<div id="map" style="padding: 10px;">
	<div class="row">
		<div class="area top left"></div>
		<div class="area top"></div>
		<div class="area top right"></div>
		<div class="area top left"></div>
		<div class="area top"></div>
		<div class="area top right"></div>
		<div class="area top left"></div>
		<div class="area top"></div>
		<div class="area top right"></div>
	</div>
	<div class="row">
		<div class="area left"></div>
		<div class="area"></div>
		<div class="area right"></div>
		<div class="area left"></div>
		<div class="area"></div>
		<div class="area right"></div>
		<div class="area left"></div>
		<div class="area"></div>
		<div class="area right"></div>
	</div>
	<div class="row">
		<div class="area left bottom"></div>
		<div class="area bottom"></div>
		<div class="area bottom right"></div>
		<div class="area bottom left"></div>
		<div class="area bottom"></div>
		<div class="area bottom right"></div>
		<div class="area bottom left"></div>
		<div class="area bottom"></div>
		<div class="area bottom right"></div>
	</div>
	<div class="row">
		<div class="area top left"></div>
		<div class="area top"></div>
		<div class="area top right"></div>
		<div class="area top left"></div>
		<div class="area top"></div>
		<div class="area top right"></div>
		<div class="area top left"></div>
		<div class="area top"></div>
		<div class="area top right"></div>
	</div>
	<div class="row">
		<div class="area left"></div>
		<div class="area"></div>
		<div class="area right"></div>
		<div class="area left"></div>
		<div class="area"></div>
		<div class="area right"></div>
		<div class="area left"></div>
		<div class="area"></div>
		<div class="area right"></div>
	</div>
	<div class="row">
		<div class="area left bottom"></div>
		<div class="area bottom"></div>
		<div class="area bottom right"></div>
		<div class="area bottom left"></div>
		<div class="area bottom"></div>
		<div class="area bottom right"></div>
		<div class="area bottom left"></div>
		<div class="area bottom"></div>
		<div class="area bottom right"></div>
	</div>
	<div class="row">
		<div class="area top left"></div>
		<div class="area top"></div>
		<div class="area top right"></div>
		<div class="area top left"></div>
		<div class="area top"></div>
		<div class="area top right"></div>
		<div class="area top left"></div>
		<div class="area top"></div>
		<div class="area top right"></div>
	</div>
	<div class="row">
		<div class="area left"></div>
		<div class="area"></div>
		<div class="area right"></div>
		<div class="area left"></div>
		<div class="area"></div>
		<div class="area right"></div>
		<div class="area left"></div>
		<div class="area"></div>
		<div class="area right"></div>
	</div>
	<div class="row">
		<div class="area left bottom"></div>
		<div class="area bottom"></div>
		<div class="area bottom right"></div>
		<div class="area bottom left"></div>
		<div class="area bottom"></div>
		<div class="area bottom right"></div>
		<div class="area bottom left"></div>
		<div class="area bottom"></div>
		<div class="area bottom right"></div>
	</div>
</div>

<button id="finishBtn">submit</button>
</body>
</html>